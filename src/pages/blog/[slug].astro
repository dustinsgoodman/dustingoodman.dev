---
import { type CollectionEntry, getCollection } from 'astro:content';
import Layout from '@/layouts/base.astro';
import BlogPost from '@/components/BlogPost.astro';

export async function getStaticPaths() {
	const posts = await getCollection('blog');

	return posts.map((post) => {
		return {
			params: {
				slug: post.slug,
			},
			props: {
				post,
			},
		};
	});
}

interface Props {
	post: CollectionEntry<'blog'>;
}

const { post } = Astro.props;
const { title, description, heroImage, redirectUrl, originalArticle } =
	post.data;
const canonicalUrl = new URL(Astro.url.pathname, Astro.site).toString();
const { Content } = await post.render();
---

<Layout
	title={title}
	description={description}
	socialImage={`https://dustingoodman.dev${heroImage.src}`}
	canonicalUrl={canonicalUrl}
	redirectUrl={redirectUrl || originalArticle}
>
	<BlogPost post={post}>
		<Content />
	</BlogPost>
</Layout>
