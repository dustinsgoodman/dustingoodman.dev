---
import { Image } from 'astro:assets';
import { type CollectionEntry } from 'astro:content';

export interface Props {
	post: CollectionEntry<'blog'>;
	className?: String;
	layout?: 'card' | 'list';
}

const { post, className, layout = 'card' } = Astro.props as Props;
const isOffsite = !!post.data.originalArticle;
const isCard = layout === 'card';
const isList = layout === 'list';

const formatDate = (date: Date) => {
	return date.toLocaleString('default', {
		month: 'short',
		day: 'numeric',
		year: 'numeric',
	});
};

const getReadMoreText = (postSource: string | undefined) => {
	if (postSource === 'Medium') {
		return 'Read more on Medium.com';
	}

	if (postSource === 'ThisDot') {
		return 'Read more on ThisDot.co';
	}

	return 'Read more';
};
---

<a
	href={isOffsite ? post.data.originalArticle : `/blog/${post.slug}`}
	target={isOffsite ? '_blank' : '_self'}
	class:list={[
		'group block rounded-xl bg-white dark:bg-gray-600 border-2 border-blue-100 hover:border-blue-600 dark:border-slate-400 dark:hover:border-blue-300 hover:no-underline overflow-clip hover:shadow-lg shadow-blue-900',
		className,
	]}
	rel="noopener noreferrer"
>
	<article
		class:list={[
			'flex',
			{ 'flex-col h-full': isCard, 'flex-row w-full': isList },
		]}
	>
		<div
			class:list={[
				'bg-blue-900 flex',
				{
					'h-48 sm:h-64 order-first mb-4': isCard,
					'w-48 sm:w-1/3 order-last': isList,
				},
			]}
		>
			<Image
				src={post.data.heroImage}
				alt={post.data.alt}
				class="relative max-h-48 w-full object-contain sm:max-h-64"
				loading="lazy"
			/>
		</div>
		<div class:list={['flex flex-col grow px-4', { 'w-2/3 p-4': isList }]}>
			<p class="mb-1 text-sm text-gray-500 dark:text-gray-200">
				{formatDate(post.data.publishDate)}
			</p>
			<h2
				class="m-0 text-2xl text-blue-600 group-hover:text-blue-800 dark:text-blue-100 dark:group-hover:text-blue-300"
			>
				{post.data.title}
			</h2>

			<div class="grow py-2 text-gray-500 dark:text-gray-200">
				{post.data.description}
			</div>
			<div
				class="py-2 font-bold text-blue-600 group-hover:text-blue-800 dark:text-blue-100 dark:group-hover:text-blue-300"
			>
				{getReadMoreText(post.data.originalSource)} &rarr;
			</div>
		</div>
	</article>
</a>
